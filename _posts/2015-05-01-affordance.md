---
layout: post
title: 在光驱位加ssd小计
date: 2015-05-01
categories: blog
tags: [问题解决,ssd]
description: 万道相通，给电脑光驱位换ssd是最近解决过的一个比较有成就感的事情，记录一下，顺便反思一下遇到的问题和中间自己的思考过程。
---

###事情经过
现在在用的电脑是联想v2000小新，小新是有光驱的。因为巧合，我顺到了一个ssd，想要买个光驱位的硬盘架使得现有硬盘和ssd两个硬盘都可以用。于是想买个硬盘架装上，网上一查硬盘架,发现光驱的型号有12.7和9.5两种厚度类型，而手边的说明书根本就没有光驱的数据，网上搜索产品信息，也没有找到。最后搜索“小新v2000 硬盘架”，发现了这么一个帖子：[聯想小新 V1000 V2000 V3000 筆記本光驅位固態硬盤托架支架盒]（http://tw.taobao.com/item/44984527421.htm?spm=a1z3o.7695283.0.0.jryxBE），在帖子里面，找到了光驱厚度的信息：9.5mm。于是京东下单，等硬盘架子到。
第二天，架子到了。我的思路是不希望重装系统，毕竟重装一次系统，需要重装各个软件，配置各个软件，还免不了丢掉一些要紧的信息。我记忆中是可以通过ghost来做这件事，但是没有在一方是ssd的情况下做过，网上找了一下，直接ghost貌似不会对ssd做4k对齐，会影响性能。于是继续找了一下，找到了这样一个工具：[傲梅分区助手](http://www.disktool.cn/)。这个工具有一个功能是迁移系统到固态硬盘（贴心！）。于是找了一个硬盘盒，将ssd装入，做成一个usb的移动硬盘，然后做系统迁移。因为usb2.0的龟速加上c盘比较大，所以需要耐心等待一会。我在做的时候，发现完成的时候报错：错误号6，"The partition table on the disk failed to update as other programs locked the partition table, please close other programs and retry.", 看着这个信息，头都大了，因为这个分区助手在迁移的时候是在preos模式做的，我猜这个preos模式应该是类似于PE的一个模式，使得windows并没有启动，这样对于某些文件的读写拷贝不会出现问题。这种情况下怎么会锁分区表？百思不得其解，我看了一下硬盘盒，因为这个硬盘盒子比较破旧了，以前接入硬盘做移动硬盘的时候，曾经出现过使用过程中移动硬盘突然不可用的情况（有可能是因为供电）；于是睡前重试一次，第二天一早一看，貌似成功了（不能确认，因为ssd的文件和大小都和c盘一样了，文件夹结构都在。但是不能确定是不是存在某些文件拷贝不成功的情况）。正当我暗自庆幸的时候，磨难确才刚刚开始...

于是上螺丝刀，拆开笔记本，挪出光驱换上ssd。启动，然后选择从ssd启动，正常看到了win7的徽标，然后...蓝屏了。我因为是夜里面做的os迁移，没有完全确保c盘的迁移过程中没有问题，所以我想是不是os迁移的时候某些文件拷贝出了问题。这时旁边一个电脑装机高手过来帮我看情况。他从ssd启动试图进入安全模式，失败！然后他查看一步一步加载的windows文件，发现在加载disk.sys的时候系统就会奔溃，他分析说是不是因为驱动的关系？然后拆下硬盘，把ssd挂到了硬盘位置，这次成功启动了。成功启动说明c盘的文件拷贝没有大问题。然后他把机械硬盘装到了光驱位置，然后从硬盘位的ssd启动，但是，在系统里面死活不能发现机械硬盘（光驱位硬盘）。资源管理器，设备管理器里面都没有。但是光驱位的硬盘指示灯是亮的，且在闪烁。切换到pe下，发现可以看到机械硬盘，并且可以正常读写。但是启动到win7下就是看不到。高手分析是系统的问题，要我重装一个系统。我考虑重装一个系统代价太大，加上当时突然有一些其他的事情要做，所以作别高手。我将机械硬盘装回硬盘位，将ssd装到光驱位，然后从机械硬盘启动，准备先把事情处理完。启动进入系统之后，惊喜的发现竟然可以看到ssd的盘符，而且可以正常的读写，测了一下ssd的读速度，有400M左右。接下来赶紧把事情处理完毕。事情处理完后，我整理了一下思路，同时google了一下。现在的头绪：
* 从硬盘位的ssd启动，看不到机械硬盘；从硬盘位的机械硬盘启动，可以读写ssd。一开始怀疑可能是电源的问题或者是硬盘盒的质量导致电流的问题，可能是机械硬盘要求电流大，但是如果是电流的原因，那么windows设备管理器里面应该会有提示才对（以前移动硬盘因为数据线的问题，windows在设备管理器中会有设备不可用等信息）；在pe中看到之后，怀疑是驱动的问题。
* 网上的帖子看，有联想工程师回答说小新的另一款的光驱位的电路设计不一样，不一定支持光驱位硬盘。不知道真假如何。
* 从有店家在卖光驱位硬盘盒子，说明这个机器的硬件上是支持的，怕的是店家卖的是特制版本的硬盘盒子。
* 有详细的帖子将v3000加ssd成功的
* 有帖子说硬盘位的接口和光驱位的接口不一样，然后bios中硬盘的ACHI/IDE模式可能会有影响。这个电脑的bios中设置的选项与硬盘相关的就这一个，我依次试了一下，发现没有用，都找不到机械硬盘。想了一下，因为前面的pe中可以看到的情况，所以没有在这个方面多花时间。

综上，现在问题集中到了驱动上面。问题到了软件层面，解决的可能性就大多了。如果在硬件上，因为不了解，所以解决的可能性就小。最怕的是联想在设计笔记本电路的时候犯轴，把电流弄得比较小，或者bios中做限制，不过改动这种通用的接口的电气信息的风险和适配的工作量应该不小，联想看来没有下黑手。再google了一阵子，得到了很多乱七八糟的信息，但是有一篇引起了我的注意[BIOS Detects but Windows 7 Does Not - Troubleshooting Hard Drive Issue ](https://www.youtube.com/watch?v=8q_wd4GvGuA),和我的情况几乎一模一样，我的注意力首先被吸引到了画面开始他用的一个软件上，intel storage rapid technology，这个软件竟然可以检测到两个硬盘！我找了一阵软件，但是没有找到这个软件，只找到各种raid的drive，没敢乱装。但是从视频来看，问题在驱动上，而且我在pe下能看到在win7下不能，也说明是软件的问题而不是硬件的问题。我找了一个360驱动助手，先尝试打补丁，因为有可能是某个主板驱动没有装上导致的问题。将所有的驱动更新到最新后，重启，发现没有解决问题。在设备管理器里面把各个项看了一下，根据名字和理解，大概定位到了IDE ATA/ATAPI控制器这一项（这是搞定之后的名字，之前好像叫另一个名字）。进入PE，我发现这一项的下的信息和win7下的名字是不一样的，同时我注意到PE下用的是默认的微软的驱动，而win7下用的是intel的驱动。照理来说，intel的驱动应该比微软好才对，亦或这个PE魔改了，将某些驱动的参数的阈值调小，使得不稳定的设备也能识别，这样的话，那就没有办法了，但是这种可能性较小才对。另外就是，我注意到PE都是win8的系统，难道是win8用了更新的驱动？这个驱动能不能用到win7下？于是我将驱动拷贝到出去；同时试图在win7下将相应的主板驱动卸载。我的打算是，如果卸载驱动能解决问题，那么先卸载试试。如果卸载了也不能，那么试试靠拷过来的win8的驱动。装win8驱动的风险不在于win8的驱动不能装上，而是在于win8的驱动能装上但是带来各种兼容性问题。先备份了驱动，然后开始卸载驱动，卸载了驱动（如果直接从设备管理器卸载，选上删除的选择框）之后，提示重启，重启进入系统之后，再提示重启。继续卸载了一个驱动，重启，进入系统，机械硬盘出现了！！！后面又重复尝试摸索了一下，确定是哪个驱动带来的问题：是intel的主板驱动。这里有一个坑，就是第一次卸载了这个驱动之后，提示重启才能生效，重启后进入系统，还会在提示重启，这个时候，还是看不到机械硬盘的，但是如果再次重启，就能看到机械硬盘了，也就是要”重启两次“！ 如果不是连续卸载驱动，估计就错过了。到这里，机械硬盘基本可用了。我以为问题已经解决，使用了一段时间后，合上电脑，带电脑到另一个地方去了会，过了会打开,机械硬盘又丢了！！！重启之后又会找到硬盘。网上查了一下，这种现象倒是很常见，很多帖子说，但是没有人给出解决方案： 
* 是硬盘盒子的问题，硬盘盒子质量不好，导致供电不足。 这种情况不排除，遇上这种，只能对硬盘架退货了。
* 有人说是硬盘盒子通道设置问题，我看了一下，确实有4中通道模式，默认就是第三种，IBM & others。找到了一个帖子[笔记本光驱位硬盘托架通道保护开关的作用 ](https://bbs.taobao.com/catalog/thread/154521-268181731.htm),根据描述，里面主要解决兼容问题，表现是不能关机（没有），卡死（没有），速度慢（测过硬盘速度，很快），现象不太吻合。尝试了一下不同通道，貌似没有什么影响。暂时排除。
* 有说是电源设置的问题，win7在用电池的情况下会优化电池使用。我猜测会一定时间后自动切断某些东西的电源，比如硬盘。这样就会导致硬盘不能识别，但是这有不符合的地方，因为我是休眠后才会丢硬盘。但是这个提醒了我，把电源设置成高性能模式，在有电池的时候至少不会丢硬盘（使用到现在，暂时没有在使用过程中丢过）。
* 一个说法是win7的一个bug，从休眠状态恢复时，由于大硬盘（大于等于1T）的硬盘恢复较慢，没有在一定时间应答，那么win7就会蓝屏（我碰到过一次，就一次），然后微软出了一个补丁：kb977178（大硬盘休眠补丁） 。我尝试打了一下补丁，但是打不上，查了一下，貌似win7 sp1 不能打这个补丁， 另根据这个帖子[is KB977178 integrated to sp1](http://www.sevenforums.com/windows-updates-activation/169845-kb977178-integrated-sp1.html)，貌似这个补丁没有包括在sp1内。网上查到一些旁门左道，可以强制打补丁，但是风险极大，不准备尝试了。正道就是卸载sp1，但是这个电脑的sp1不能卸载（微软说计算机预装的sp1不能卸载）。 

考虑到现在基本上使用过程中设置了电源之后，在盖上盖子移动的过程中偶尔掉（刚用了两三天，掉过一次）。如果是平时插上电源使用，没有掉过。我平时拿上电脑移动的频率不高，如果一个星期掉一次也可以接受，另外ssd的盘挺大的，把平时常用的放到了c盘，所以对机械硬盘的要求就降低了。综合来看，如果频率非常小的掉，并且对机械硬盘只是用来存不常用的数据的话，那么基本上可以先用着，然后看看情况在看看有没有必要进一步深究问题了。

#有用的信息
1. 光驱类型的判断
直接去查相应机械的光驱位硬盘架的商品，然后看详细信息。这比去找机器的信息然后找光驱信息有用得多，机器的信息上一般没有带光驱的具体信息。或者直接拆下光驱看（我不太确定光驱上有，但是猜想应该有参数，万一没有也可以用尺子量）

2. 用傲梅分区助手来转移操作系统到ssd，而不是重装，如果出问题，可以用报错的信息去google。一般的，出于对于线和接口等因素的考虑，出了问题后，重新插拔一下硬盘（插拔硬盘盒，usb），然后重试一次也是一个选择。

3. 有些品牌机不支持直接从光驱位的硬盘启动，我碰到过这个问题，但是原因不清楚（按理说能从光驱启动，就能从光驱位的硬盘启动才对）。看到买的光驱位硬盘盒子上有提示这个信息，才联想到我前面碰到的现象。我的现象是启动到一半加载disk.sys的时候蓝屏。所以，最好直接从硬盘位的硬盘启动。

4. 如果在bios（有的被阉割的bios里面没有显示硬盘相关的信息的页面，但是在决定启动顺序的时候可以看到这个硬盘）里面可以看到，或者在PE里面可以使用光驱位的硬盘，但是进入系统之后不能看到，请考虑是驱动的问题。不只是intel的驱动会出现这个问题，其他的主板驱动也在帖子上看到过这个问题。所以，可以下载一个驱动软件（如驱动助手），备份驱动之后，把主板相关的驱动进行卸载。用微软的默认驱动试试。

5. 如果发生使用过程中的掉硬盘，或者disk.sys导致的蓝屏。首先如果你能打补丁，打上KB977178。同时，在电源的高级设置里面把光驱的电源（如果有的话）改成不关闭。 补丁可以解决蓝屏。如果是因为电源关闭打开导致的问题，电源调整可解决这个问题。


#学到的东西
1. 不要用穷举代替思考。对于遇到的问题，确认好问题是什么，小心观察分析已有的条件，然后在思考怎么求解。穷举表面上看起来是快，但是其实是对未知的恐惧，对思考的恐惧，忙碌了半天，对解决问题不一定有益。
2. 对于未知，大胆假设，小心求证。在很多的事情里面，肯定有一些是未知领域，对于未知领域。要多去了解已有的经验，同时要有自己的判断和分析。在这个问题里面，硬件的东西确实不了解，所以从网上查了相关的信息。根据这些信息和观察到的现象做出的假设对于推进问题的解决才是很有帮助的。还是那句话，要按照基本法-则，当然我们的决定权也是很重要的。
3. 在信息时代，对信息的查找很重要，对信息的判断也是很重要的技能。从最开始组织词语去google，到后来对google上的信息做判断，大多数情况下，只要你认真表达了问题，答案都在google的结果里面，只是看你能不能综合google的结果去找到它，做出认真的判断罢了。
4. 跳出思维的盒子。在这个case里面，盒子有两个，一个是认为从光驱能启动那么从光驱位的硬盘也能启动；一个认为是驱动不会出问题，驱动出了问题win7也会显示相关信息。很多的时候，我们的思考基于这些假设，这些盒子帮我们了局限了问题的场景，简化了相关情况；但是，我们也要时刻注意不要被这些盒子阻碍了我们解决问题。





